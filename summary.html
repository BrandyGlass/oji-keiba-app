<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é›†è¨ˆã‚µãƒãƒªãƒ¼ | ãŠã˜.exe v4.1</title>
  <style>
    :root{
      --bg:#0f172a; --card:#1e293b; --accent:#38bdf8; --text:#f8fafc;
      --muted:#94a3b8; --good:#22c55e; --bad:#ef4444; --radius:16px;
      --focus: 0 0 0 3px rgba(56,189,248,.35);
      --tap:44px;
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html, body { height:100%; }
    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", sans-serif;
      background: var(--bg); color: var(--text); margin: 0; padding: 16px; line-height: 1.5;
    }
    a{ color: inherit; }
    :focus-visible{ outline:none; box-shadow: var(--focus); }

    .header { margin-bottom: 20px; text-align: center; }
    .title { font-weight: 900; font-size: 22px; color: var(--accent); }
    .sub { font-size: 12px; color: var(--muted); margin-top: 4px; }

    .chips { display: flex; gap: 8px; justify-content: center; margin: 16px 0; flex-wrap: wrap; }
    .chip{
      padding: 8px 16px; border-radius: 999px; background: #334155; color: var(--text);
      font-size: 12px; text-decoration: none; font-weight: 900;
      min-height: var(--tap);
      display:inline-flex; align-items:center; justify-content:center;
      touch-action: manipulation;
    }

    section{
      background: var(--card); padding: 16px; margin-bottom: 20px; border-radius: var(--radius);
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05);
    }
    h2{
      font-size: 14px; color: var(--accent); margin: 0 0 12px;
      border-left: 3px solid var(--accent); padding-left: 8px;
    }
    .kpi-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px; }
    .kpi-card { background: rgba(0,0,0,0.2); padding: 12px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.06); }
    .kpi-val { font-size: 20px; font-weight: 900; display: block; }
    .kpi-label { font-size: 10px; color: var(--muted); }

    .table-wrapper { overflow-x: auto; border-radius: 12px; }
    table { width: 100%; border-collapse: collapse; font-size: 12px; min-width: 450px; }
    th { background: rgba(255,255,255,0.05); color: var(--muted); font-weight: 700; text-align: right; padding: 10px 6px; }
    td { padding: 12px 6px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: right; }
    th:first-child, td:first-child { text-align: left; position: sticky; left: 0; background: var(--card); }

    .good { color: var(--good); font-weight: 900; }
    .bad { color: var(--bad); font-weight: 900; }

    .note { font-size: 11px; color: var(--muted); margin-top: 10px; text-align: center; }
    .empty {
      text-align:center; color: var(--muted);
      margin: 40px 0 10px;
      padding: 14px;
      border: 1px dashed rgba(255,255,255,0.15);
      border-radius: 12px;
      background: rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="title">é›†è¨ˆã‚µãƒãƒªãƒ¼.exe</div>
    <div class="sub">è¦‹ã‚‹ã ã‘ãƒ»è§¦ã‚‰ãªã„ãƒ»æ„Ÿæƒ…ç¦æ­¢</div>
  </div>

  <div class="chips">
    <a href="index.html" class="chip">ğŸ¯ äºˆæƒ³</a>
    <a href="review.html" class="chip">ğŸ“ æŒ¯ã‚Šè¿”ã‚Š</a>
  </div>

  <section id="overall-section">
    <h2>ğŸ† ç·åˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h2>
    <div class="kpi-grid">
      <div class="kpi-card"><span class="kpi-val" id="kpi-roi">-</span><span class="kpi-label">é€šç®—å›åç‡</span></div>
      <div class="kpi-card"><span class="kpi-val" id="kpi-profit">-</span><span class="kpi-label">é€šç®—ç´”åæ”¯</span></div>
      <div class="kpi-card"><span class="kpi-val" id="kpi-hitrate">-</span><span class="kpi-label">çš„ä¸­ç‡(BUY)</span></div>
      <div class="kpi-card"><span class="kpi-val" id="kpi-skiprate">-</span><span class="kpi-label">è¦‹é€ã‚Šç‡</span></div>
    </div>
    <div class="table-wrapper"><table id="overall"></table></div>
  </section>

  <section>
    <h2>âš–ï¸ ã‚¾ãƒ¼ãƒ³åˆ¥åˆ†æ</h2>
    <div class="table-wrapper"><table id="byZone"></table></div>
    <div class="note">A:ä¸»æˆ¦å ´ / B:å§”ä»» / C:æµã‚Œ / D:ã‚„ã‚Šéã”ã—ï¼ˆâ€”ã¯æœªå…¥åŠ›/æ—§ãƒ‡ãƒ¼ã‚¿ï¼‰</div>
  </section>

  <section>
    <h2>ğŸ“… æœˆåˆ¥æ¨ç§»</h2>
    <div class="table-wrapper"><table id="byMonth"></table></div>
  </section>

<script>
(() => {
  "use strict";

  const KEY = "oji_review_logs_v21";
  const el = (id) => document.getElementById(id);

  const loadLogs = () => {
    try {
      const v = JSON.parse(localStorage.getItem(KEY) || "[]");
      return Array.isArray(v) ? v : [];
    } catch { return []; }
  };

  // âœ… å¼·ã„æ•°å€¤åŒ–ï¼ˆã‚«ãƒ³ãƒé™¤å»ãƒ»NaNå¯¾ç­–ï¼‰
  const num = (v) => {
    if (v === null || v === undefined) return 0;
    const s = String(v).replace(/,/g, "").trim();
    if (s === "") return 0;
    const n = Number(s);
    return Number.isFinite(n) ? n : 0;
  };

  const sum = (arr, fn) => arr.reduce((a, b) => a + fn(b), 0);
  const groupBy = (arr, keyFn) => arr.reduce((acc, cur) => {
    const k = keyFn(cur);
    (acc[k] ||= []).push(cur);
    return acc;
  }, {});

  const fmtRoi = (r) => `<span class="${r >= 1 ? 'good' : 'bad'}">${(r * 100).toFixed(1)}%</span>`;
  const fmtProfit = (p) => `<span class="${p >= 0 ? 'good' : 'bad'}">${p.toLocaleString()}</span>`;

  const makeTable = (targetEl, headers, rows) => {
    if (!targetEl) return;
    targetEl.innerHTML =
      "<thead><tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr></thead>" +
      "<tbody>" + rows.map(r => "<tr>" + r.map(c => `<td>${c}</td>`).join("") + "</tr>").join("") + "</tbody>";
  };

  const showEmpty = (msg) => {
    const box = document.createElement("div");
    box.className = "empty";
    box.textContent = msg;
    document.body.appendChild(box);
  };

  const logs = loadLogs();
  if (logs.length === 0) {
    showEmpty("ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯æŒ¯ã‚Šè¿”ã‚Šã§1ä»¶ä¿å­˜ã—ã¦ãã ã•ã„ã€‚");
    return;
  }

  const isBuy = (l) => l.bought === "è²·ã£ãŸ";
  const isSkip = (l) => l.bought === "è¦‹é€ã£ãŸ" || l.bought === "è²·ã‚ãªã‹ã£ãŸ";
  const isHit = (l) => l.result === "çš„ä¸­";

  const buyLogs = logs.filter(isBuy);
  const totalStake = sum(logs, l => num(l.stake));
  const totalPayout = sum(logs, l => num(l.payout));
  const totalProfit = totalPayout - totalStake;
  const totalRoi = totalStake > 0 ? totalPayout / totalStake : 0;
  const hitRate = buyLogs.length > 0 ? (buyLogs.filter(isHit).length / buyLogs.length) : 0;
  const skipRate = logs.length > 0 ? (logs.filter(isSkip).length / logs.length) : 0;

  // KPI
  const kpiRoi = el("kpi-roi");
  const kpiProfit = el("kpi-profit");
  if (kpiRoi) {
    kpiRoi.innerHTML = (totalRoi * 100).toFixed(1) + "%";
    kpiRoi.className = `kpi-val ${totalRoi >= 1 ? 'good' : 'bad'}`;
  }
  if (kpiProfit) {
    kpiProfit.innerHTML = (totalProfit >= 0 ? "+" : "") + totalProfit.toLocaleString();
    kpiProfit.className = `kpi-val ${totalProfit >= 0 ? 'good' : 'bad'}`;
  }
  el("kpi-hitrate") && (el("kpi-hitrate").innerText = (hitRate * 100).toFixed(1) + "%");
  el("kpi-skiprate") && (el("kpi-skiprate").innerText = (skipRate * 100).toFixed(1) + "%");

  // 1) å…¨ä½“
  makeTable(el("overall"), ["ç·æ•°", "BUY", "SKIP", "è³­é‡‘", "æ‰•æˆ»", "åæ”¯", "å›åç‡"], [[
    logs.length,
    buyLogs.length,
    logs.filter(isSkip).length,
    totalStake.toLocaleString(),
    totalPayout.toLocaleString(),
    fmtProfit(totalProfit),
    fmtRoi(totalRoi)
  ]]);

  // 2) Zoneï¼ˆâœ… â€œâ€”â€ ã‚‚å«ã‚ã‚‹ï¼0ä»¶ã¯è¡¨ç¤ºã—ãªã„ï¼‰
  const byZone = groupBy(logs, l => l.zone || "â€”");
  const zoneRows = ["A", "B", "C", "D", "â€”"].map(z => {
    const arr = byZone[z] || [];
    if (arr.length === 0) return null;

    const bArr = arr.filter(isBuy);
    const s = sum(arr, l => num(l.stake));
    const p = sum(arr, l => num(l.payout));
    const roi = s > 0 ? p / s : 0;
    const hit = bArr.length > 0 ? (bArr.filter(isHit).length / bArr.length) : 0;

    return [
      z,
      arr.length,
      bArr.length,
      (hit * 100).toFixed(1) + "%",
      s.toLocaleString(),
      p.toLocaleString(),
      fmtProfit(p - s),
      fmtRoi(roi)
    ];
  }).filter(Boolean);

  makeTable(
    el("byZone"),
    ["Zone", "ä»¶æ•°", "BUY", "çš„ä¸­ç‡", "è³­é‡‘", "æ‰•æˆ»", "åæ”¯", "å›åç‡"],
    zoneRows.length ? zoneRows : [["-", "0", "0", "-", "0", "0", fmtProfit(0), fmtRoi(0)]]
  );

  // 3) æœˆåˆ¥ï¼ˆâœ… Dateã§å®‰å®šã‚½ãƒ¼ãƒˆï¼‰
  const byMonth = groupBy(logs, l => (l.date || "").slice(0, 7) || "â€”");
  const monthRows = Object.entries(byMonth)
    .sort(([a], [b]) => new Date(b + "-01") - new Date(a + "-01"))
    .map(([m, arr]) => {
      const bArr = arr.filter(isBuy);
      const s = sum(arr, l => num(l.stake));
      const p = sum(arr, l => num(l.payout));
      const roi = s > 0 ? p / s : 0;
      return [
        m,
        arr.length,
        bArr.length,
        s.toLocaleString(),
        p.toLocaleString(),
        fmtProfit(p - s),
        fmtRoi(roi)
      ];
    });

  makeTable(el("byMonth"), ["æœˆ", "ä»¶æ•°", "BUY", "è³­é‡‘", "æ‰•æˆ»", "åæ”¯", "å›åç‡"], monthRows);
})();
</script>
</body>
</html>
