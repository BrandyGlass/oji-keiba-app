<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>おじ.exe（競馬プロジェクト）</title>
  <style>
    :root { --pad: 16px; --line: rgba(255,255,255,.10); }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:-apple-system, system-ui, "Hiragino Sans", "Noto Sans JP", sans-serif;
      background:#0b1220; color:#e9eefc;
    }
    .wrap{ max-width:820px; margin:0 auto; padding:var(--pad); }
    .card{
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      border-radius:18px;
      padding:18px;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
      backdrop-filter: blur(8px);
      margin-bottom:14px;
    }
    h1{ font-size:22px; margin:0 0 6px; }
    h2{ font-size:16px; margin:0 0 10px; color:#cfe0ff; }
    .sub{ font-size:13px; color:rgba(233,238,252,.75); line-height:1.5; margin:0 0 14px; }
    .pill{
      display:inline-block; font-size:12px; padding:6px 10px;
      border-radius:999px; border:1px solid var(--line);
      background:rgba(0,0,0,.18); color:rgba(233,238,252,.85);
      margin-right:6px; margin-bottom:6px;
    }
    .hr{ height:1px; background:var(--line); margin:14px 0; }
    .q{
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      margin:12px 0;
    }
    .qTitle{ font-weight:800; margin:0 0 10px; }
    .btnRow{ display:flex; gap:10px; flex-wrap:wrap; }
    button{
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      color:#e9eefc;
      border-radius:16px;
      padding:14px 14px;
      font-size:16px;
      font-weight:800;
      cursor:pointer;
      flex:1;
      min-width:160px;
    }
    button.primary{ background:#e9eefc; color:#0b1220; border-color:transparent; }
    button.danger{ background:rgba(255,80,80,.12); border-color:rgba(255,80,80,.22); color:#ffd7d7; }
    .note{ font-size:12px; color:rgba(233,238,252,.65); line-height:1.5; margin-top:10px; }
    .hide{ display:none; }
    .bigMsg{
      font-size:16px; line-height:1.6;
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      margin-top:12px;
    }
    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size:12px; color:rgba(233,238,252,.8);
      white-space:pre-wrap;
    }
    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:rgba(0,0,0,.75); border:1px solid var(--line);
      color:#fff; padding:10px 12px; border-radius:14px;
      font-size:13px; opacity:0; pointer-events:none;
      transition:opacity .18s ease;
      max-width:92vw;
    }
    .toast.show{ opacity:1; }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- Header -->
    <div class="card">
      <h1>おじ.exe（競馬プロジェクト）</h1>
      <p class="sub">
        目的：迷わない／感情で買わない／決めた手順通りに動く<br>
        入口（STEP0〜STEP1）実装済み。次でSTEP2以降を入れる。
      </p>
      <span class="pill">複勝1点</span>
      <span class="pill">1R 500円</span>
      <span class="pill">最大3レース/日</span>
      <span class="pill">得意条件：中山ダ1800 / 東京ダ1600</span>
    </div>

    <!-- STEP0 -->
    <section id="step0" class="card">
      <h2>STEP0｜前提確認（10秒）</h2>

      <div class="q">
        <p class="qTitle">Q1：今日は最大3レースまで、というルールを守れる？</p>
        <div class="btnRow">
          <button class="primary" data-next="step0_q2" data-set="step0_q1:yes">はい</button>
          <button class="danger" data-skip="today_limit" data-set="step0_q1:no">いいえ</button>
        </div>
        <p class="note">No が出たら、その時点で終了（今日は見送り）。</p>
      </div>

      <div id="step0_q2" class="q hide">
        <p class="qTitle">Q2：このレースは500円だけで買う？</p>
        <div class="btnRow">
          <button class="primary" id="goStep1" data-set="step0_q2:yes">はい</button>
          <button class="danger" data-skip="money_rule" data-set="step0_q2:no">いいえ</button>
        </div>
        <p class="note">「500円だけ」が守れないなら、このレースは見送り。</p>
      </div>
    </section>

    <!-- STEP1 -->
    <section id="step1" class="card hide">
      <h2>STEP1｜対象レース判定（即断）</h2>

      <div class="q">
        <p class="qTitle">Q3：このレースは重賞（G1〜G3）？</p>
        <div class="btnRow">
          <button class="primary" id="isGradedYes" data-set="step1_q3:yes">はい</button>
          <button id="isGradedNo" data-set="step1_q3:no">いいえ</button>
        </div>
        <p class="note">重賞は買う対象に含める（ただしSTEP0の資金ルールは絶対）。</p>
      </div>

      <div id="step1_q4" class="q hide">
        <p class="qTitle">Q4：得意条件に当てはまる？</p>
        <div class="btnRow">
          <button class="primary" data-pick="nakayama_d1800">中山ダ1800</button>
          <button class="primary" data-pick="tokyo_d1600">東京ダ1600</button>
          <button class="danger" data-pick="none">どれでもない</button>
        </div>
        <p class="note">東京芝1400は一時停止（選択肢に存在しない）。</p>
      </div>

      <div id="step1_pass" class="bigMsg hide">
        <div style="font-weight:900; margin-bottom:6px;">✅ 対象レース：OK</div>
        <div class="mono" id="passSummary"></div>
        <div class="btnRow" style="margin-top:12px;">
          <button class="primary" id="goStep2">STEP2へ進む</button>
          <button class="danger" id="skipHere">今回は見送る</button>
        </div>
        <p class="note">※STEP2以降は次の実装で本体化します（いまは遷移確認）。</p>
      </div>
    </section>

    <!-- STEP2 (placeholder) -->
    <section id="step2" class="card hide">
      <h2>STEP2｜候補抽出（※準備中）</h2>
      <p class="sub">
        次の実装でここに「候補抽出の質問＋見送りボタン」を入れ込みます。<br>
        いまは入口が正しく動くかの確認用。
      </p>
      <div class="btnRow">
        <button class="danger" id="skipFromStep2">今回は見送る</button>
        <button class="primary" id="restart">最初から</button>
      </div>
    </section>

    <!-- SKIP -->
    <section id="skip" class="card hide">
      <h2>見送り</h2>
      <p class="sub">見送りは正解ルート。型に従った判断です。</p>
      <div class="bigMsg">
        <div style="font-weight:900; margin-bottom:6px;">✅ 見送りを選択しました</div>
        <div class="mono" id="skipReason"></div>
        <div style="margin-top:10px; font-size:12px; color:rgba(233,238,252,.7);">
          No bet is a bet. 見送れる日は、型が守れている日。
        </div>
      </div>
      <div class="btnRow" style="margin-top:12px;">
        <button class="primary" id="restart2">最初から</button>
      </div>
    </section>

  </div>

  <div class="toast" id="toast"></div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);
  const toast = $("toast");

  const state = {
    step0_q1: null,
    step0_q2: null,
    step1_q3: null,       // graded?
    step1_q4: null,       // course pick
  };

  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 1100);
  }

  function showSection(id){
    ["step0","step1","step2","skip"].forEach(s => $(s).classList.add("hide"));
    $(id).classList.remove("hide");
    window.scrollTo({top:0, behavior:"smooth"});
  }

  function showEl(id){
    $(id).classList.remove("hide");
  }

  function setFromData(setStr){
    // "key:value"
    if(!setStr) return;
    const [k,v] = setStr.split(":");
    state[k] = v;
  }

  function goSkip(reasonKey){
    const map = {
      today_limit: "STEP0で終了：最大3レース/日が守れない → 今日は見送り。",
      money_rule:  "STEP0で終了：500円固定が守れない → このレースは見送り。",
      not_target:  "STEP1で終了：重賞でも得意条件でもない → 見送り。",
      user_skip:   "おじ判断：今回は見送る（正解ルート）。"
    };
    $("skipReason").textContent =
      (map[reasonKey] || "見送りを選択しました。") +
      "\n\n-- 状態 --\n" + JSON.stringify(state, null, 2);

    showSection("skip");
  }

  // Global click handlers for data attributes
  document.addEventListener("click", (e) => {
    const btn = e.target.closest("button");
    if(!btn) return;

    // set state
    setFromData(btn.dataset.set);

    // show next element
    if(btn.dataset.next){
      showEl(btn.dataset.next);
      showToast("次へ");
    }

    // skip
    if(btn.dataset.skip){
      goSkip(btn.dataset.skip);
    }
  });

  // STEP0 -> STEP1
  $("goStep1").addEventListener("click", () => {
    if(state.step0_q1 !== "yes"){ return; }
    state.step0_q2 = "yes";
    showSection("step1");
  });

  // STEP1: graded yes -> pass
  function passTarget(summaryLines){
    $("passSummary").textContent = summaryLines.join("\n");
    showEl("step1_pass");
    showToast("対象OK");
  }

  $("isGradedYes").addEventListener("click", () => {
    state.step1_q3 = "yes";
    state.step1_q4 = "graded";
    passTarget([
      "対象：重賞（G1〜G3）",
      "注意：500円固定／最大3レース/日は絶対",
      "次：STEP2（候補抽出）へ"
    ]);
  });

  // STEP1: graded no -> show Q4
  $("isGradedNo").addEventListener("click", () => {
    state.step1_q3 = "no";
    showEl("step1_q4");
    showToast("得意条件を選ぶ");
  });

  // Q4 pick
  $("step1_q4").addEventListener("click", (e) => {
    const btn = e.target.closest("button");
    if(!btn || !btn.dataset.pick) return;

    const pick = btn.dataset.pick;
    state.step1_q4 = pick;

    if(pick === "none"){
      goSkip("not_target");
      return;
    }

    const label = (pick === "nakayama_d1800") ? "中山ダ1800" : "東京ダ1600";
    passTarget([
      `対象：得意条件（${label}）`,
      "注意：500円固定／最大3レース/日は絶対",
      "次：STEP2（候補抽出）へ"
    ]);
  });

  // Pass -> Step2 (placeholder)
  $("goStep2").addEventListener("click", () => showSection("step2"));
  $("skipHere").addEventListener("click", () => goSkip("user_skip"));
  $("skipFromStep2").addEventListener("click", () => goSkip("user_skip"));

  // Restart
  function resetAll(){
    state.step0_q1 = null;
    state.step0_q2 = null;
    state.step1_q3 = null;
    state.step1_q4 = null;

    $("step0_q2").classList.add("hide");
    $("step1_q4").classList.add("hide");
    $("step1_pass").classList.add("hide");

    showSection("step0");
    showToast("リセット");
  }
  $("restart").addEventListener("click", resetAll);
  $("restart2").addEventListener("click", resetAll);

  // Init
  showSection("step0");
})();
</script>
</body>
</html>
