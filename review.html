<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä»Šæ—¥ã®é¦¬åˆ¸æŒ¯ã‚Šè¿”ã‚Š</title>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 16px;
      line-height: 1.4;
    }
    h1 { font-size: 20px; margin-bottom: 12px; }
    section {
      background: #fff;
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 8px;
    }
    label { display: block; font-size: 14px; margin-top: 8px; }
    select, input, textarea {
      width: 100%;
      margin-top: 4px;
      padding: 8px;
      font-size: 14px;
      box-sizing: border-box;
    }
    textarea { resize: none; }
    .radio-group { margin-top: 8px; }
    .radio-group label { display: block; font-size: 14px; }
    .note { font-size: 12px; color: #666; margin-top: 4px; }

    .header { margin-bottom: 12px; }
    .title { font-weight: 800; font-size: 18px; margin-bottom: 4px; }
    .sub { color: #666; font-size: 12px; margin-bottom: 8px; }
    .chips { display: flex; gap: 8px; flex-wrap: wrap; }
    .chip {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid #ddd;
      background: #fff;
      color: #111;
      font-size: 13px;
      text-decoration: none;
    }

    .btnRow { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    button {
      border: 1px solid #ddd;
      background: #fff;
      padding: 10px 12px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
    }
    button.primary {
      background: #111;
      color: #fff;
      border-color: #111;
      flex: 1;
      min-width: 160px;
    }
    button.secondary { flex: 1; min-width: 160px; }
    button.danger {
      border-color: #ff5d73;
      color: #b00020;
      flex: 1;
      min-width: 160px;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco,
                   Consolas, "Liberation Mono", "Courier New", monospace;
    }
    .hr { height: 1px; background: #eee; margin: 12px 0; }
  </style>
</head>

<body>
  <div class="header">
    <div class="title">ä»Šæ—¥ã®é¦¬åˆ¸æŒ¯ã‚Šè¿”ã‚Š</div>
    <div class="sub">çµæœã¨åˆ¤æ–­ã‚’åˆ‡ã‚Šé›¢ã—ã¦è¨˜éŒ²ã™ã‚‹ï¼ˆç«¯æœ«å†…ä¿å­˜ï¼‰</div>
    <div class="chips">
      <a href="index.html" class="chip">â† äºˆæƒ³ã«æˆ»ã‚‹</a>
    </div>
  </div>

  <h1>ğŸ ä»Šæ—¥ã®é¦¬åˆ¸æŒ¯ã‚Šè¿”ã‚Š</h1>

  <section>
    <strong>STEP 1ï½œãƒ¬ãƒ¼ã‚¹</strong>
    <label>æ—¥ä»˜ <input id="date" type="date" /></label>

    <label>ç«¶é¦¬å ´
      <select id="track">
        <option>ä¸­å±±</option><option>æ±äº¬</option><option>é˜ªç¥</option>
        <option>äº¬éƒ½</option><option>ä¸­äº¬</option><option>æœ­å¹Œ</option>
        <option>å‡½é¤¨</option><option>ç¦å³¶</option><option>æ–°æ½Ÿ</option>
        <option>å°å€‰</option><option>ãã®ä»–</option>
      </select>
    </label>

    <label>ãƒ¬ãƒ¼ã‚¹ç•ªå·
      <select id="raceNo">
        <option>1R</option><option>2R</option><option>3R</option>
        <option>4R</option><option>5R</option><option>6R</option>
        <option>7R</option><option>8R</option><option>9R</option>
        <option>10R</option><option>11R</option><option>12R</option>
      </select>
    </label>
  </section>

  <section>
    <strong>STEP 2ï½œåˆ¤æ–­ã®ç½®ãå ´æ‰€</strong>
    <div class="radio-group">
      <label><input type="radio" name="zone" value="A"> Aï¼šä¸»æˆ¦å ´</label>
      <label><input type="radio" name="zone" value="B"> Bï¼šå§”ä»»ï¼ˆè¨˜è€…ï¼‰</label>
      <label><input type="radio" name="zone" value="C"> Cï¼šæµã‚Œ</label>
      <label><input type="radio" name="zone" value="D"> Dï¼šã‚„ã‚Šéã”ã—</label>
    </div>
  </section>

  <section>
    <strong>STEP 3ï½œèª°ã®åˆ¤æ–­ã‹</strong>
    <label>åˆ¤æ–­ä¸»ä½“
      <select id="actor">
        <option>è‡ªåˆ†</option>
        <option>è¨˜è€…</option>
        <option>ãã®ä»–</option>
      </select>
    </label>

    <label id="writerWrap" style="display:none;">è¨˜è€…å
      <input id="writerName" placeholder="ä¾‹ï¼šã‚µãƒ³ã‚¹ãƒç¶¿è¶Š" />
    </label>

    <label>ç†ç”±
      <textarea id="reason" rows="2"></textarea>
    </label>
  </section>

  <section>
    <strong>STEP 4ï½œçµæœ</strong>

    <label>è²·ã£ãŸï¼Ÿ
      <select id="bought">
        <option>è²·ã£ãŸ</option>
        <option>è²·ã‚ãªã‹ã£ãŸ</option>
      </select>
    </label>

    <label>çµæœ
      <select id="result">
        <option>çš„ä¸­</option>
        <option>ä¸çš„ä¸­</option>
        <option>è²·ã‚ãšã«çš„ä¸­</option>
      </select>
    </label>

    <label>è³­ã‘é‡‘ï¼ˆå††ï¼‰
      <input id="stake" type="number" value="500" step="100" />
    </label>

    <label>æ‰•æˆ»ï¼ˆå††ï¼‰
      <input id="payout" type="number" />
    </label>

    <label>ä¸€è¨€ãƒ¡ãƒ¢
      <textarea id="memo" rows="2"></textarea>
    </label>

    <div class="btnRow">
      <button class="primary" id="btnSave">ä¿å­˜</button>
      <button class="secondary" id="btnReset">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
  </section>

  <section>
    <strong>LOGï¼ˆCSVï¼‰</strong>
    <div class="btnRow">
      <button class="secondary" id="btnCopyCSV">CSVã‚³ãƒ”ãƒ¼</button>
      <button class="secondary" id="btnDownloadCSV">CSVä¿å­˜</button>
      <button class="danger" id="btnClear">å…¨æ¶ˆã—</button>
    </div>
    <div class="hr"></div>
    <pre class="mono" id="logPreview"></pre>
  </section>

<script>
(() => {
  const KEY = "oji_review_logs_v2";
  const el = (id) => document.getElementById(id);

  const todayISO = () => new Date().toISOString().slice(0,10);
  const nowStr = () => new Date().toISOString().slice(0,16).replace("T"," ");

  const loadLogs = () => JSON.parse(localStorage.getItem(KEY) || "[]");
  const saveLogs = (logs) => localStorage.setItem(KEY, JSON.stringify(logs));

  const csvVal = (v) => {
    if (v === null || v === undefined) return "";
    if (typeof v === "number") return v;
    return `"${String(v).replace(/"/g,'""')}"`;
  };

  const toCSV = (logs) => {
    const headers = [
      "ts","date","track","raceNo",
      "zone","actor","writerName","reason",
      "bought","result",
      "stake","payout","profit","roi",
      "memo"
    ];
    const lines = [headers.join(",")];
    logs.forEach(l => {
      lines.push([
        l.ts,l.date,l.track,l.raceNo,
        l.zone,l.actor,l.writerName,l.reason,
        l.bought,l.result,
        l.stake,l.payout,l.profit,l.roi,
        l.memo
      ].map(csvVal).join(","));
    });
    return lines.join("\n");
  };

  const refresh = () => {
    const csv = toCSV(loadLogs());
    el("logPreview").textContent = csv.split("\n").slice(-10).join("\n");
  };

  el("date").value = todayISO();

  el("actor").addEventListener("change", () => {
    el("writerWrap").style.display =
      el("actor").value === "è¨˜è€…" ? "" : "none";
  });

  el("btnSave").addEventListener("click", () => {
    const zone = document.querySelector('input[name="zone"]:checked')?.value;
    if (!zone) return alert("zoneã‚’é¸æŠã—ã¦ãã ã•ã„");

    const stake = Number(el("stake").value || 0);
    const payout = Number(el("payout").value || 0);
    const profit = payout - stake;
    const roi = stake > 0 ? Math.round((payout / stake) * 100) / 100 : 0;

    const logs = loadLogs();
    logs.push({
      ts: nowStr(),
      date: el("date").value,
      track: el("track").value,
      raceNo: el("raceNo").value,
      zone,
      actor: el("actor").value,
      writerName: el("writerName").value,
      reason: el("reason").value,
      bought: el("bought").value,
      result: el("result").value,
      stake, payout, profit, roi,
      memo: el("memo").value
    });
    saveLogs(logs);
    refresh();
    alert("ä¿å­˜ã—ã¾ã—ãŸ");
  });

  el("btnReset").addEventListener("click", () => location.reload());
  el("btnCopyCSV").addEventListener("click", () => navigator.clipboard.writeText(toCSV(loadLogs())));
  el("btnDownloadCSV").addEventListener("click", () => {
    const blob = new Blob([toCSV(loadLogs())], {type:"text/csv"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "oji_review.csv";
    a.click();
  });
  el("btnClear").addEventListener("click", () => {
    if (confirm("æ¶ˆã—ã¾ã™ã‹ï¼Ÿ")) {
      localStorage.removeItem(KEY);
      refresh();
    }
  });

  refresh();
})();
</script>
</body>
</html>
