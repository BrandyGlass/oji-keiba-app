<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä»Šæ—¥ã®é¦¬åˆ¸æŒ¯ã‚Šè¿”ã‚Š</title>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 16px;
      line-height: 1.4;
    }
    h1 { font-size: 20px; margin-bottom: 12px; }
    section {
      background: #fff;
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 8px;
    }
    label { display: block; font-size: 14px; margin-top: 8px; }
    select, input, textarea {
      width: 100%;
      margin-top: 4px;
      padding: 8px;
      font-size: 14px;
    }
    textarea { resize: none; }
    .radio-group { margin-top: 8px; }
    .radio-group label { display: block; font-size: 14px; }
    .note { font-size: 12px; color: #666; margin-top: 4px; }

    .header { margin-bottom: 12px; }
    .title { font-weight: 800; font-size: 18px; margin-bottom: 4px; }
    .sub { color: #666; font-size: 12px; margin-bottom: 8px; }
    .chips { display: flex; gap: 8px; flex-wrap: wrap; }
    .chip {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid #ddd;
      background: #fff;
      color: #111;
      font-size: 13px;
      text-decoration: none;
    }

    .btnRow { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    button {
      border: 1px solid #ddd;
      background: #fff;
      padding: 10px 12px;
      border-radius: 10px;
      font-weight: 800;
      cursor: pointer;
      flex: 1;
      min-width: 160px;
    }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button.danger { background:#ffe9ec; border-color:#ffb7c0; color:#7a0010; }
    .logbox {
      white-space: pre;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      color: #111;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      overflow:auto;
      max-height: 260px;
    }
  </style>
</head>

<body>
  <div class="header">
    <div class="title">ä»Šæ—¥ã®é¦¬åˆ¸æŒ¯ã‚Šè¿”ã‚Š</div>
    <div class="sub">çµæœã¨åˆ¤æ–­ã‚’åˆ‡ã‚Šé›¢ã—ã¦è¨˜éŒ²ã™ã‚‹</div>
    <div class="chips">
      <a href="index.html" class="chip">â† äºˆæƒ³ã«æˆ»ã‚‹</a>
    </div>
  </div>

  <h1>ğŸ ä»Šæ—¥ã®é¦¬åˆ¸æŒ¯ã‚Šè¿”ã‚Š</h1>

  <section>
    <strong>STEP 1ï½œãƒ¬ãƒ¼ã‚¹</strong>

    <label>æ—¥ä»˜
      <input id="date" type="date" />
    </label>

    <label>ç«¶é¦¬å ´
      <select id="track">
        <option>ä¸­å±±</option>
        <option>æ±äº¬</option>
        <option>é˜ªç¥</option>
        <option>äº¬éƒ½</option>
        <option>ä¸­äº¬</option>
        <option>æœ­å¹Œ</option>
        <option>å‡½é¤¨</option>
        <option>ç¦å³¶</option>
        <option>æ–°æ½Ÿ</option>
        <option>å°å€‰</option>
        <option>ãã®ä»–</option>
      </select>
    </label>

    <label>ãƒ¬ãƒ¼ã‚¹ç•ªå·
      <select id="raceNo">
        <option>1R</option><option>2R</option><option>3R</option>
        <option>4R</option><option>5R</option><option>6R</option>
        <option>7R</option><option>8R</option><option>9R</option>
        <option>10R</option><option>11R</option><option>12R</option>
      </select>
    </label>
  </section>

  <section>
    <strong>STEP 2ï½œåˆ¤æ–­ã®ç½®ãå ´æ‰€</strong>
    <div class="radio-group">
      <label><input type="radio" name="zone" value="A" /> ğŸ  Aï¼šä¸»æˆ¦å ´ï¼ˆä¸­å±±ãƒ€1800ãƒ»è‡ªåˆ†ï¼‰</label>
      <label><input type="radio" name="zone" value="B" /> ğŸ“° Bï¼šå§”ä»»ï¼ˆè¨˜è€…ï¼‰</label>
      <label><input type="radio" name="zone" value="C" /> ğŸŒŠ Cï¼šæµã‚Œè²·ã„</label>
      <label><input type="radio" name="zone" value="D" /> ğŸ›‘ Dï¼šã‚„ã‚Šéã”ã—</label>
    </div>
    <div class="note">â€»1ã¤ã ã‘é¸ã¶</div>
  </section>

  <section>
    <strong>STEP 3ï½œèª°ã®åˆ¤æ–­ã‹</strong>

    <label>åˆ¤æ–­ä¸»ä½“
      <select id="actor">
        <option>è‡ªåˆ†</option>
        <option>è¨˜è€…</option>
        <option>ãã®ä»–</option>
      </select>
    </label>

    <label>è¨˜è€…åï¼ˆä»»æ„ï¼šactorãŒè¨˜è€…ã®ã¨ãï¼‰
      <input id="writerName" placeholder="ä¾‹ï¼šç«¶é¦¬ãƒ©ãƒœ / ã€‡ã€‡è¨˜è€…" />
    </label>

    <label>ç†ç”±ï¼ˆ1è¡Œãƒ»ä»»æ„ï¼‰
      <textarea id="reason" rows="2" placeholder="èª¿æ•™ã¨å‰èµ°ãŒè‰¯ã„ / ã‚ªãƒƒã‚ºãŒå®‰ã„ ãªã©"></textarea>
    </label>
  </section>

  <section>
    <strong>STEP 4ï½œçµæœ</strong>

    <label>è²·ã£ãŸï¼Ÿ
      <select id="bought">
        <option>è²·ã£ãŸ</option>
        <option>è²·ã‚ãªã‹ã£ãŸ</option>
      </select>
    </label>

    <label>çµæœ
      <select id="result">
        <option>çš„ä¸­</option>
        <option>ä¸çš„ä¸­</option>
        <option>è²·ã‚ãšã«çš„ä¸­</option>
        <option>è²·ã‚ãšã«ä¸çš„ä¸­</option>
      </select>
    </label>

    <label>ä¸€è¨€ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰
      <textarea id="memo" rows="2" placeholder="å·®åˆ†ã¯é¨æ‰‹ / å®‰ãã¦ã‚¹ãƒ«ãƒ¼ã§æ­£è§£"></textarea>
    </label>

    <div class="btnRow">
      <button class="primary" id="btnSave">ä¿å­˜</buttonï¸</button>
      <button id="btnCopyCSV">CSVã‚³ãƒ”ãƒ¼</button>
      <button id="btnDownloadCSV">CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
      <button class="danger" id="btnClear">ãƒ­ã‚°å…¨æ¶ˆã—</button>
    </div>

    <div class="note">ä¿å­˜å…ˆï¼šã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆlocalStorageï¼‰ã€‚æ©Ÿç¨®å¤‰æ›´/ãƒ–ãƒ©ã‚¦ã‚¶å¤‰æ›´ã§æ¶ˆãˆã‚‹å¯èƒ½æ€§ã‚ã‚Šã€‚</div>
  </section>

  <section>
    <strong>ãƒ­ã‚°ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰</strong>
    <div id="logPreview" class="logbox"></div>
  </section>

<script>
(() => {
  // ===== Storage =====
  const KEY = "oji_keiba_review_v1";

  const loadLogs = () => {
    try { return JSON.parse(localStorage.getItem(KEY) || "[]"); }
    catch { return []; }
  };
  const saveLogs = (logs) => localStorage.setItem(KEY, JSON.stringify(logs));

  // ===== Utils =====
  const el = (id) => document.getElementById(id);
  const todayISO = () => {
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${dd}`;
  };
  const nowStr = () => {
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    return `${y}-${m}-${dd} ${hh}:${mm}`;
  };
  const getZone = () => {
    const x = document.querySelector('input[name="zone"]:checked');
    return x ? x.value : "";
  };

  // ===== CSV =====
  const toCSV = (logs) => {
    const headers = ["ts","date","track","raceNo","zone","actor","writerName","reason","bought","result","memo"];
    const esc = (s) => `"${String(s ?? "").replace(/"/g,'""')}"`;
    const lines = [headers.join(",")];
    logs.forEach(l => {
      lines.push([
        l.ts, l.date, l.track, l.raceNo, l.zone, l.actor, l.writerName,
        l.reason, l.bought, l.result, l.memo
      ].map(esc).join(","));
    });
    return lines.join("\n");
  };

  const refreshPreview = () => {
    const logs = loadLogs();
    const csv = toCSV(logs);
    const lines = csv.split("\n");
    const preview = lines.slice(0,1).concat(lines.slice(Math.max(1, lines.length-12))).join("\n");
    el("logPreview").textContent = preview || "ã¾ã ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“";
  };

  // ===== Init =====
  el("date").value = todayISO();
  refreshPreview();

  // ===== Save =====
  el("btnSave").addEventListener("click", () => {
    const date = el("date").value || todayISO();
    const track = el("track").value;
    const raceNo = el("raceNo").value;

    const zone = getZone();
    if (!zone) { alert("STEP2ï¼šåˆ¤æ–­ã®ç½®ãå ´æ‰€ï¼ˆAã€œDï¼‰ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚"); return; }

    const actor = el("actor").value;
    const writerName = (el("writerName").value || "").trim();
    const reason = (el("reason").value || "").trim();
    const bought = el("bought").value;
    const result = el("result").value;
    const memo = (el("memo").value || "").trim();

    const logs = loadLogs();
    logs.push({
      ts: nowStr(),
      date, track, raceNo,
      zone, actor,
      writerName: (actor === "è¨˜è€…" ? writerName : ""),
      reason, bought, result, memo
    });
    saveLogs(logs);
    refreshPreview();
    alert("ä¿å­˜ã—ã¾ã—ãŸï¼ˆreviewãƒ­ã‚°ï¼‰ã€‚");
  });

  // ===== Copy CSV =====
  el("btnCopyCSV").addEventListener("click", async () => {
    const csv = toCSV(loadLogs());
    try {
      await navigator.clipboard.writeText(csv);
      alert("CSVã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚");
    } catch {
      alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚iOSã®è¨­å®š/æ¨©é™ã®å½±éŸ¿ãŒã‚ã‚‹ã‹ã‚‚ã€‚");
    }
  });

  // ===== Download CSV =====
  el("btnDownloadCSV").addEventListener("click", () => {
    const csv = toCSV(loadLogs());
    const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `oji_keiba_review_${todayISO()}.csv`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  // ===== Clear =====
  el("btnClear").addEventListener("click", () => {
    if (!confirm("reviewãƒ­ã‚°ã‚’å…¨æ¶ˆã—ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
    localStorage.removeItem(KEY);
    refreshPreview();
    alert("reviewãƒ­ã‚°ã‚’å…¨æ¶ˆã—ã—ã¾ã—ãŸã€‚");
  });
})();
</script>
</body>
</html>
